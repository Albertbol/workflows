name: Firebase work flow
on:
  workflow_call:
jobs:
  cache:
    name: Cache
    runs-on: ubuntu-latest
    steps:
      - uses: ./.github/actions/node-setup
      - run: npm ci
        working-directory: functions
  qa:
    needs: cache
    runs-on: ubuntu-latest
    steps:
      - uses: ./.github/actions/lint
  build:
    needs: qa
    name: Build
    runs-on: ubuntu-latest
    steps:
      - uses: ./.github/actions/build
        with:
          working-directory: functions
  test:
    needs: build
    name: Tests
    runs-on: ubuntu-latest
    steps:
      - uses: ./.github/actions/build
        with:
          working-directory: functions
        env:
          GCP_SA_KEY: ${{ secrets.GCP_SA_KEY }}

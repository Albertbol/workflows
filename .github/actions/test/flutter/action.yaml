name: Test
description: Flutter test
inputs:
  WORKFLOW_APP_ID:
    description: 'The ID of the GitHub App to use to authenticate the workflow'
    required: true
  WORKFLOW_APP_KEY:
    description: 'The key to use to authenticate the workflow'
    required: true
runs:
  using: "composite"
  steps:
    - uses: actions/create-github-app-token@v1
      id: app-token
      with:
        app-id: ${{ inputs.WORKFLOW_APP_ID }}
        private-key: ${{ inputs.WORKFLOW_APP_KEY }}
        owner: ${{ github.repository_owner }}
    - uses: actions/checkout@v4
      with:
        token: ${{ steps.app-token.outputs.token }}
        ref: ${{ github.head_ref }}
          # Make sure the value of GITHUB_TOKEN will not be persisted in repo's config
        persist-credentials: false    
    - uses: subosito/flutter-action@main
      with:
        channel: "stable"
    
    - shell: bash
      run: |
        git clone --mirror git@github.com:Albertbol/flutter-packages-monorepo.git
        flutter pub get
        flutter --version
        flutter test